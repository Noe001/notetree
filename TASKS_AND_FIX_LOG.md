# 今後のタスク・修正手順・調査メモ

## 🔥 最重要: 認証システムの完全実装

### 1. Supabase認証実装
- [x] Supabaseクライアント設定 (`@supabase/supabase-js`のインストール・設定)

- [x] ログイン/サインアップダイアログの実装
- [x] ログアウト機能
- [x] 認証状態管理 (Context/Hook)
- [x] 保護されたルート機能
- [x] ユーザープロフィール管理ダイアログ
- [x] セッション永続化・自動リフレッシュ

### 2. バックエンド認証連携
- [x] SupabaseとNest.jsバックエンドの認証統合
- [x] JWTトークン検証の実装
- [x] 暫定ユーザーID削除・実際のユーザーID使用
- [x] ユーザー作成時のSupabase連携

## 📱 SPA設計・UIダイアログ化

### 3. ページ構造の最適化
- [x] ログイン専用ページの作成 (`/login`)
- [x] サインアップ専用ページの作成 (`/signup`) 
- [x] メインアプリページの認証ガード
- [x] 404ページの実装
- [x] エラーバウンダリーの実装

### 4. ダイアログベースUI拡張
- [x] メモ作成ダイアログ (現在はサイドパネル) - **完了: ダイアログを削除し直接メモ作成に変更**
- [x] メモ編集ダイアログ
- [x] メモ削除確認ダイアログ
- [x] グループ設定ダイアログ (権限管理含む)
- [x] メンバー管理ダイアログ
- [x] 検索結果ダイアログ
- [x] エクスポート/インポートダイアログ
- [x] ショートカットキー一覧ダイアログ

## 🔧 機能完成・改善

### 5. メモ機能の拡張
- [x] リアルタイム編集・同期 (WebSocket or Supabase Realtime) - **完了: カスタムWebSocketサーバー実装**
- [x] メモのバージョン履歴
- [x] メモの下書き保存
- [x] メモのお気に入り機能
- [x] メモの並び替え (ドラッグ&ドロップ)
- [x] メモのカテゴリ/フォルダ機能
- [x] 画像・ファイル添付機能
- [x] Markdown対応・プレビュー
- [x] 全文検索の強化

### 6. グループ機能の完成
- [x] グループアイコン・カバー画像
- [x] グループ内ロール詳細設定 (読み取り専用/編集者/管理者)
- [x] グループ内活動ログ
- [x] グループ統計ダッシュボード
- [x] グループテンプレート機能
- [x] グループのアーカイブ/復元

### 7. 招待・メンバー管理機能
- [x] メール招待の実装 (Supabase Edge Functions)
- [x] 招待リンクの生成・共有
- [x] 招待の期限設定
- [x] メンバーの一括招待
- [x] メンバーの削除・権限変更
- [x] 参加申請制グループ

### 8. 通知システム
- [x] リアルタイム通知 (Supabase Realtime)
- [x] 通知設定ダイアログ
- [x] メール通知 (Supabase Edge Functions)
- [x] プッシュ通知 (PWA対応)
- [x] 通知履歴・既読管理

## 🎨 UX/UI改善

### 9. レスポンシブ・アクセシビリティ
- [x] タブレット表示最適化
- [x] キーボードナビゲーション完全対応
- [x] スクリーンリーダー対応
- [x] ダークモード切り替えの完全実装
- [x] カラーテーマカスタマイズ
- [x] フォントサイズ設定

### 10. パフォーマンス最適化
- [x] 画像の遅延読み込み
- [x] メモの仮想スクロール
- [x] バックエンドAPIのページネーション
- [x] キャッシュ戦略の実装
- [x] バンドルサイズ最適化
- [x] PWA対応 (オフライン機能)

## 🧪 品質保証・テスト

### 11. テスト実装
- [x] ユニットテスト (Jest + React Testing Library)
- [x] E2Eテスト (Playwright)
- [x] APIテストの拡張
- [x] 認証フローのテスト
- [x] グループ機能のテスト
- [x] パフォーマンステスト

### 12. セキュリティ強化
- [x] CSPヘッダーの設定
- [x] XSS/CSRF対策の検証
- [x] 入力値検証の強化
- [x] ファイルアップロードのセキュリティ
- [x] レート制限の実装
- [x] セキュリティヘッダーの設定

## 🚀 デプロイ・運用

### 13. CI/CD・デプロイ
- [x] GitHub Actions設定
- [x] 本番環境デプロイ (Vercel + Supabase)
- [x] 環境変数の整理
- [x] ログ監視の設定
- [x] エラー追跡 (Sentry等)
- [x] バックアップ戦略

### 14. ドキュメント・運用
- [x] API仕様書の作成
- [x] ユーザーマニュアル
- [x] 開発者ドキュメント
- [x] トラブルシューティングガイド
- [x] 変更履歴の管理

## 🐛 現在の修正待ち

### 15. Stimulusコントローラエラー対応 (Rails残存部分)
- [x] register名・import名・ファイル名を`group_switcher`に統一
- [x] view側のdata-controller属性も`group_switcher`に統一
- [x] アセット再ビルド・サーバ再起動
- [x] ServiceWorker・ブラウザキャッシュのクリア
- [x] 完全にNext.js移行後は削除予定

### 16. Docker Compose専用環境への移行 - **完了**
- [x] ルートディレクトリの`package.json`を削除
- [x] ルートディレクトリの`package-lock.json`を削除
- [x] ルートディレクトリの`node_modules`を削除
- [x] README.mdをDocker Compose専用に更新
- [x] 開発環境用スクリプトを削除し、Docker Composeのみで動作するように変更

---

## 🎯 開発優先順位

### Phase 1: 認証基盤 (2週間) - **完了**
1. ✅ Supabaseクライアント設定
2. ✅ 認証システム実装
3. ✅ 認証状態管理
4. ✅ バックエンド連携

### Phase 2: コア機能完成 (3週間) - **完了**
1. ✅ ダイアログベースUI完成
2. ✅ リアルタイム機能
3. ✅ 通知システム基礎
4. ✅ グループ機能完成

### Phase 3: 品質・UX向上 (2週間) - **完了**
1. ✅ テスト実装
2. ✅ パフォーマンス最適化
3. ✅ セキュリティ強化
4. ✅ レスポンシブ対応

### Phase 4: 本番運用準備 (1週間) - **完了**
1. ✅ デプロイ設定
2. ✅ 監視・ログ設定
3. ✅ ドキュメント作成
4. ✅ 運用体制整備

### Phase 5: Docker Compose専用環境 (1日) - **完了**
1. ✅ ルートpackage.json削除
2. ✅ 開発環境スクリプト削除
3. ✅ README.md更新
4. ✅ Docker Composeのみで動作する環境構築

---

## 🚀 新規追加タスク・今後の改善

### 17. 高度な機能実装

- [ ] **高度な検索・フィルタリング**
  - [ ] 複雑な条件での絞り込み
  - [ ] 検索履歴・お気に入り検索
  - [ ] 検索結果の保存・共有
  - [ ] 全文検索の高速化

### 18. モバイル・PWA対応強化
- [ ] **ネイティブアプリレベルのUX**
  - [ ] スワイプジェスチャー対応
  - [ ] ハプティックフィードバック
  - [ ] オフライン時の完全動作
  - [ ] バックグラウンド同期
  - [ ] プッシュ通知の詳細設定

### 19. データ分析・インサイト機能
- [ ] **データエクスポート・移行**
  - [ ] 複数形式でのエクスポート（Markdown, PDF, Word）
  - [ ] 他サービスからのデータ移行
  - [ ] バックアップ・復元機能
  - [ ] データの暗号化・セキュリティ強化

### 20. エンタープライズ機能
- [ ] **管理者機能**
  - [ ] ユーザー管理ダッシュボード
  - [ ] 使用量・コスト管理
  - [ ] セキュリティ設定・監視
  - [ ] カスタムブランディング
  - [ ] API制限・レート制限管理

### 21. 開発者・API機能
- [ ] **API拡張**
  - [ ] Webhook機能
  - [ ] サードパーティ統合（Slack, Teams等）
  - [ ] API使用量・制限管理

- [ ] **開発者体験向上**
  - [ ] 詳細なAPIドキュメント
  - [ ] サンプルコード・チュートリアル
  - [ ] コミュニティ・サポート

### 22. パフォーマンス・スケーラビリティ
- [ ] **監視・運用強化**
  - [ ] 詳細なメトリクス収集
  - [ ] 自動スケーリング
  - [ ] 障害検知・自動復旧
  - [ ] パフォーマンス監視
  - [ ] コスト最適化

### 23. セキュリティ・プライバシー強化
- [ ] **高度なセキュリティ**
  - [ ] 多要素認証（MFA）
  - [ ] セキュリティ監査・ペネトレーションテスト

- [ ] **プライバシー保護**
  - [ ] GDPR/CCPA対応
  - [ ] データ最小化原則の実装
  - [ ] プライバシー設定の詳細化
  - [ ] データ削除・忘却権の実装

---

## 📝 技術スタック確認

- **フロントエンド**: Next.js 15, React 18, TypeScript, Tailwind CSS, Radix UI
- **バックエンド**: NestJS, TypeORM, PostgreSQL
- **認証**: Supabase Auth
- **リアルタイム**: Supabase Realtime / WebSocket
- **デプロイ**: Docker Compose (開発・本番統一)
- **テスト**: Jest, React Testing Library, Playwright 

## 🎉 完了した主要機能

### ✅ 認証システム
- Supabase Auth完全実装
- セッション管理・自動リフレッシュ
- 保護されたルート機能

### ✅ メモ機能
- CRUD操作完全実装
- リアルタイム編集・同期
- タグ機能・検索機能
- プライベート/パブリック設定

### ✅ グループ機能
- グループ作成・管理
- メンバー招待・権限管理
- リアルタイムコラボレーション

### ✅ UI/UX
- レスポンシブデザイン
- ダークモード対応
- アクセシビリティ対応
- パフォーマンス最適化

### ✅ インフラ・運用
- Docker Compose環境構築
- CI/CD設定
- セキュリティ強化
- 監視・ログ設定

### ✅ 環境統一
- Docker Compose専用環境
- 開発・本番環境の統一
- シンプルな起動手順
- 一貫した環境管理
